name: Performance — Stress Test (k6)

on:
  schedule:
    - cron: '0 0 * * 0' # Executa todos os domingos à meia-noite
  workflow_dispatch:
    inputs:
      target_url:
        description: 'URL para o teste de stress'
        required: true
        default: 'https://api.pizzaria-rural.com/api/pizzas'

jobs:
  k6_test:
    name: Running Stress Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run k6 load test
        uses: grafana/k6-action@v0.3.1
        with:
          filename: infra/stress_test.js
          flags: --env API_URL=${{ github.event.inputs.target_url || 'https://api.pizzaria-rural.com/api/pizzas' }}
